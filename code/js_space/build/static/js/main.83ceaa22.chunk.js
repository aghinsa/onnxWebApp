(this["webpackJsonpmodel-inference"]=this["webpackJsonpmodel-inference"]||[]).push([[0],{155:function(e,t,n){e.exports=n(276)},160:function(e,t,n){},276:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(10),s=n.n(r),l=(n(160),n(24)),c=n(15),i=n(42),u=n(43),d=n(46),p=n(304),m=n(308),h=n(58),f=function(e){return o.a.createElement(p.a,{position:"static"},o.a.createElement(m.a,null,o.a.createElement(h.a,{variant:"h5",color:"inherit"},"Models")))},g=n(12),v=n.n(g),b=n(20),w=n(18),_=n(316),k=n(310),y=n(311),j=n(278),O=n(312),E=n(317),C=n(309),x=n(313),S=n(314),R=n(17),A=n(97),D=n.n(A),F=n(140),I=n.n(F),N=n(73),T=n(54);function M(e,t){return P.apply(this,arguments)}function P(){return(P=Object(b.a)(v.a.mark((function e(t,n){var a,o,r,s,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("running inference"),a=new Date,console.log("Starting session profiling"),t.startProfiling(),e.next=6,t.run([n]);case 6:return o=e.sent,t.endProfiling(),r=o.values().next().value.data,console.log("Output data",o),console.log("got output"),console.log("OtputDataTensor :",r),s=new Date,l=s.getTime()-a.getTime(),console.log("Ran model, Time taken:",l),e.abrupt("return",[l,r]);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,n,a,o){return B.apply(this,arguments)}function B(){return(B=Object(b.a)(v.a.mark((function e(t,n,a,o,r){var s,l,c,i,u,d,p,m,h,f,g,b;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={maxNumberEvents:1e4,flushIntervalInMilliseconds:1e4,flushBatchSize:32},l=new N.InferenceSession({Profiler:s}),console.log("New config"),console.log("New session ",l),c="./"+t,console.log("Loading model from path ",c),e.next=8,fetch(c);case 8:return i=e.sent,e.next=11,i.blob();case 11:return i=e.sent,console.log("MODEL FILE ",i),e.next=15,l.loadModel(i);case 15:console.log("model loaded"),console.log("running input of shape ",n),u=J(n),d=[],p=[],console.log("running epochs :",a),m=0;case 22:if(!(m<a)){e.next=44;break}return e.prev=23,e.next=26,M(l,u);case 26:g=e.sent,b=Object(T.a)(g,2),h=b[0],f=b[1],e.next=37;break;case 32:e.prev=32,e.t0=e.catch(23),console.log("Running failed with ",e.t0),console.log("Returning -1"),h=-1;case 37:d.push(h),p.push(f),console.log("Epoch: "+(m+1)+" Time taken: "+h),r&&o(1);case 41:m++,e.next=22;break;case 44:return console.log("Inference times : ",d),console.log("running model done"),e.abrupt("return",{inference_times:d,output_data_tensors:p});case 47:case"end":return e.stop()}}),e,null,[[23,32]])})))).apply(this,arguments)}var L=n(315),V=n(76);function J(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32",a=e.reduce((function(e,t){return e*t}),1),o=D()(new Float32Array(a));I.a.random(o);var r=D()(o,e),s=new N.Tensor(r.data.data,n,e);return t?s:r}function U(){return(U=Object(b.a)(v.a.mark((function e(t,n,a){var o,r,s,l,c,i,u,d,p,m;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e){return e},r=t.shape,s=t.saved_model,e.next=4,z(s,r,n,o,!1);case 4:return l=e.sent,c=l.inference_times,i=l.output_data_tensors,console.log("handling model click done ,",c),u={inference_times:c,mean:Object(L.a)(c),std:Object(L.b)(c),output_data_tensors:i},console.log("Inference Data for model "+t.title+" data: ",u),console.log("Should save data?:",a),a&&(d=JSON.stringify(u),p=encodeURI("data:text/json;charset=utf-8,"+d),(m=document.createElement("a")).setAttribute("href",p),m.setAttribute("download","log.json"),document.body.appendChild(m),m.click()),e.abrupt("return",u);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t,n){return G.apply(this,arguments)}function G(){return(G=Object(b.a)(v.a.mark((function e(t,n,a){var o,r,s,l,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.shape,r=t.saved_model,e.next=3,z(r,o,n,a,!0);case 3:return s=e.sent,l=s.inference_times,s.output_data_tensors,console.log("handling model click done ,",l),c={inference_times:l,mean:Object(L.a)(l),std:Object(L.b)(l)},console.log("Inference Data for model "+t.title+" data: ",c),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,n){return q.apply(this,arguments)}function q(){return(q=Object(b.a)(v.a.mark((function e(t,n,a){var o,r,s,l,c,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(e,t){return Object(R.a)(Array(e).keys()).map((function(e){return t+e}))},s=function(){return(s=Object(b.a)(v.a.mark((function e(t){var o,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Getting model csv :",t),e.next=3,Y(t,n,a);case 3:return o=e.sent,console.log("In runAll inf_data :",o),r=[t.id,o.mean,o.std].concat(Object(R.a)(o.inference_times)).join(","),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)},r=function(e){return s.apply(this,arguments)},o=[],e.next=6,Promise.all(t.map(function(){var e=Object(b.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(t);case 2:n=e.sent,o.push(n),console.log("Csv string for "+t.title+" : ",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return console.log("got all csv strings,csv data",o),c=l(n,1).map((function(e){return"epoch_"+e})).join(","),i="data:text/csv;charset=utf-8,"+("model,mean,std,"+c)+"\n"+o.join("\n"),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={logs:[]},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;Object(V.Hook)(window.console,(function(t){e.setState((function(e){var n=e.logs;return{logs:[].concat(Object(R.a)(n),[Object(V.Decode)(t)])}}))})),console.log("Logging to console")}},{key:"render",value:function(){return o.a.createElement(a.Fragment,null,o.a.createElement(j.a,null,o.a.createElement("div",{style:{backgroundColor:"#242424",height:250,overflowY:"auto"}},o.a.createElement(V.Console,{logs:this.state.logs,variant:"dark"}))))}}]),t}(o.a.Component),Q={paper:{padding:20,marginTop:10,marginBottom:10,height:650,overflowY:"auto"}},W=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={status:"Start",progress:0,epochs:30,total:0,num_models:0},n.state.total=n.state.epochs*n.props.models.length,n.state.num_models=n.props.models.length,console.log("Total :",n.state.total),n.handleClick=n.handleClick.bind(Object(w.a)(n)),n.updateProgress=n.updateProgress.bind(Object(w.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"updateProgress",value:function(e){this.setState((function(t){return t.progress=t.progress+e,t}))}},{key:"handleClick",value:function(){var e=Object(b.a)(v.a.mark((function e(){var t,n,a,o,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState((function(e){return e.status="Running",e})),t=this.props.models,n=this.state.epochs,e.next=5,H(t,n,this.updateProgress);case 5:a=e.sent,this.setState((function(e){return e.status="Completed",e.progress=0,e})),console.log("Should save?:",this.props.downloadAfterRun),this.props.downloadAfterRun&&(o=encodeURI(a),(r=document.createElement("a")).setAttribute("href",o),r.setAttribute("download","inference_data.csv"),document.body.appendChild(r),r.click());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return o.a.createElement(a.Fragment,null,o.a.createElement("div",null,o.a.createElement(_.a,{id:"num_epochs",label:"Number Of Epochs",value:this.state.epochs,onChange:function(t){var n=t.target.value;e.setState((function(e){return e.epochs=n,e.total=n*e.num_models,e})),console.log("Epochs ",e.state.epochs),console.log("Total ",e.state.total)}})),o.a.createElement(k.a,{variant:"contained",color:"primary",size:"large",onClick:this.handleClick,style:{marginTop:10,marginBottom:10,marginRight:10}},this.state.status," ","Running"==this.state.status?(100*this.state.progress/this.state.total).toFixed(2)+"%":""))}}]),t}(o.a.Component),X=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={viewConsole:!1,downloadAfterRun:!0,per_model_epochs:30},n.handleCheckboxClick=n.handleCheckboxClick.bind(Object(w.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleCheckboxClick",value:function(e,t){console.log("Checkbox clicked"),this.setState((function(e){return e.downloadAfterRun=t,e}))}},{key:"showConsoleComponent",value:function(){return o.a.createElement(a.Fragment,null,this.state.viewConsole?o.a.createElement(K,null):o.a.createElement("div",null))}},{key:"render",value:function(){var e=this,t=this.props.models;return o.a.createElement(y.a,{container:!0},o.a.createElement(y.a,{item:!0,sm:!0},o.a.createElement(j.a,{style:Q.paper},o.a.createElement(O.a,{control:o.a.createElement(E.a,{checked:this.state.downloadAfterRun,color:"primary",onChange:this.handleCheckboxClick}),label:"Download log"}),o.a.createElement(_.a,{id:"per_model_num_epochs",label:"Epochs per model",value:this.state.per_model_epochs,onChange:function(t){var n=t.target.value;e.setState((function(e){return e.per_model_epochs=n,e})),console.log("Epochs ",e.state.per_model_epochs)}}),o.a.createElement(C.a,{component:"ul"},t.map((function(t){return o.a.createElement(x.a,{button:!0,key:t.id,onClick:function(){return function(e,t,n){return U.apply(this,arguments)}(t,e.state.per_model_epochs,e.state.downloadAfterRun)}},o.a.createElement(S.a,{primary:t.title}))}))))),o.a.createElement(y.a,{item:!0,sm:!0},o.a.createElement(j.a,{style:Q.paper},o.a.createElement(h.a,{variant:"h3",style:{marginTop:20,marginBottom:20,display:"block"}},"Run all models"),o.a.createElement("div",null,o.a.createElement(W,{models:t,epochs:2,downloadAfterRun:this.state.downloadAfterRun}),o.a.createElement(k.a,{variant:"contained",color:"primary",size:"large",onClick:function(){e.setState((function(e){return e.viewConsole=!e.viewConsole,e}))}},"Console")),o.a.createElement("div",null,this.showConsoleComponent()))))}}]),t}(a.Component),Z=[{id:"resnet_v1.5_224",title:"Resnet50 V1.50",description:"Resnet50 V1.50,size 224",shape:[1,3,224,224],saved_model:"resnetv1.5_224.onnx"},{id:"mobilenet_v1_224",title:"MobileNet V1 224",description:"MobileNet V1,size 224",shape:[1,3,224,224],saved_model:"mobilenetv1_224.onnx"},{id:"ssd_resnet34_1200",title:"SSD ResNet34 1200",description:"SSD ResNet34 ,size 1200",shape:[1,3,1200,1200],saved_model:"ssd_resnet34_1200_patch.onnx"},{id:"ssd_mobileNet_v1_300",title:"SSD MobileNet 300",description:"SSD MobileNet 300 ,size 1200",shape:[1,3,300,300],saved_model:"ssd_mobilenetv1_300_patch.onnx"}],$=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={models:Z},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?console.log("File reading okay"):alert("The File APIs are not fully supported by your browser."),o.a.createElement(a.Fragment,null,o.a.createElement(f,null),o.a.createElement(X,{models:this.state.models}))}}]),t}(a.Component);s.a.render(o.a.createElement($,null),document.getElementById("root"))}},[[155,1,2]]]);
//# sourceMappingURL=main.83ceaa22.chunk.js.map